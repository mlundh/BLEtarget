
#include "app.h"
#include "usbd_cdc_if.h"

uint8_t buffer[13] = {0};
int interruptFlag = 0;
int ticksBetweenSensors = 0;



void taskCyclic()
{
  if(interruptFlag)
  {
    disableExternalInterrupt();

    buffer[12]='\0';
    uint8_t validBuffer[2] = {'X','\0'};
    if(buffer[9] == 'B')
    {
      validBuffer[0] = ' ';
    }

    interruptFlag = 0; // clear the flag.

    uint8_t speedBuffer[55] = {0};
    snprintf((char *) speedBuffer, 45, "-%s-\r\nSpeed: %d %s\r\n", buffer, ticksBetweenSensors, validBuffer);

    memset(buffer,' ',13);
    CDC_Transmit_FS(speedBuffer, 45); // print to usb.

    ticksBetweenSensors = 0;
    enableExternalInterrupt();
  }
}
